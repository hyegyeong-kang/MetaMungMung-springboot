<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.metanet.metamungmung.mapper.meeting.OnMeetingBoardMapper">

    <!--하나의 모임에 있는 게시글 목록 출력-->

<!--    o.onMeetingIdx, o.onMeetName, o.createDate, o.updateDate, o.introduction,-->
<!--    o.thumbnail, o.personnel, ob.onMeetingBoardIdx, ob.onMeetingMemIdx,-->
<!--    omr.onMeetingReplyIdx, omr.memberIdx, omr.contents, omr.createDate AS replyCreateDate,-->
<!--    omr.updateDate AS replyUpdateDate, omr.writer, ob.writer AS boardWriter,-->
<!--    m.memberIdx AS memberIDX, m.memberName, m.memberImg,-->
<!--    ob.memberIdx AS boardMemberIdx, ob.contents AS boardContents-->

<!--    0421 가장 최신-->
<!--    o.onMeetingIdx, o.onMeetName, o.createDate, o.updateDate, o.introduction,-->
<!--    o.thumbnail, o.personnel, ob.onMeetingBoardIdx, ob.onMeetingMemIdx,-->
<!--    omr.onMeetingReplyIdx, omr.memberIdx, omr.contents, omr.createDate AS replyCreateDate,-->
<!--    omr.updateDate AS replyUpdateDate, omr.writer, ob.writer AS boardWriter,-->
<!--    m.memberIdx AS memberIDX, m.memberName, m.memberImg,-->
<!--    ob.memberIdx AS boardMemberIdx, ob.contents AS boardContents    -->
    <select id="getBoardList" resultMap="boardResultMap" resultType="com.metanet.metamungmung.vo.meeting.GetOnMeetingVO">
        select *
        from onMeeting o, onMeetingBoard ob, member m, onMeetingReply omr
        where o.onMeetingIdx = #{onMeetingIdx}
        and o.onMeetingIdx = ob.onMeetingIdx
        and ob.onMeetingBoardIdx = omr.onMeetingBoardIdx
        and ob.memberIdx = m.memberIdx
    </select>
<!--    <select id="getBoardList" resultType="com.metanet.metamungmung.vo.meeting.GetOnMeetingVO">-->
<!--        select o.onMeetingIdx, o.onMeetName, o.createDate, o.updateDate, o.introduction,-->
<!--               o.thumbnail, o.personnel, ob.onMeetingBoardIdx, ob.onMeetingMemIdx,-->
<!--               omr.onMeetingReplyIdx, omr.memberIdx, omr.contents, omr.createDate AS CR,-->
<!--               omr.updateDate AS UD, omr.writer, ob.writer AS W, m.memberIdx AS M, m.memberName, m.memberImg,-->
<!--               ob.memberIdx AS MM, ob.memberIdx AS MI, ob.contents AS CO-->
<!--        from onMeeting o, onMeetingBoard ob, member m, onMeetingReply omr-->
<!--        where o.onMeetingIdx = #{onMeetingIdx}-->
<!--          and o.onMeetingIdx = ob.onMeetingIdx-->
<!--          and ob.onMeetingBoardIdx = omr.onMeetingBoardIdx-->
<!--          and omr.memberIdx = m.memberIdx-->
<!--    </select>-->


    <resultMap id="boardResultMap" type="com.metanet.metamungmung.vo.meeting.GetOnMeetingVO">
            <result column="onMeetingIdx" property="onMeetingIdx"/>
            <result column="onMeetName" property="onMeetName"/>
            <result column="createDate" property="createDate"/>
            <result column="updateDate" property="updateDate"/>
            <result column="introduction" property="introduction"/>
            <result column="thumbnail" property="thumbnail"/>
            <result column="personnel" property="personnel"/>
            <collection property="boardList" autoMapping="true" resultMap="boardMap" javaType="java.util.ArrayList"/>
    </resultMap>

    <resultMap id="boardMap" type="com.metanet.metamungmung.vo.meeting.GetOnMeetingBoardVO">
        <result column="onMeetingBoardIdx" property="onMeetingBoardIdx"/>
        <result column="onMeetingMemIdx" property="onMeetingMemIdx"/>
        <result column="onMeetingIdx" property="onMeetingIdx"/>
        <result column="boardMemberIdx" property="memberIdx"/>
        <result column="boardWriter" property="boardWriter"/>
        <result column="boardContents" property="boardContents"/>
        <result column="boardCreateDate" property="boardCreateDate"/>
        <result column="boardUpdateDate" property="boardUpdateDate"/>
        <association property="boardMember" resultMap="boardMemMap" javaType="com.metanet.metamungmung.dto.member.MemberDTO"/>
        <collection property="replyList" autoMapping="true" resultMap="replyMap"/>
    </resultMap>

    <resultMap type="com.metanet.metamungmung.dto.member.MemberDTO" id="boardMemMap" >
        <result column="memberIdx" property="memberIdx"/>
        <result column="memberId" property="memberId"/>
        <result column="password" property="password"/>
        <result column="memberName" property="memberName"/>
        <result column="sex" property="sex"/>
        <result column="birth" property="birth"/>
        <result column="email" property="email"/>
        <result column="phone" property="phone"/>
        <result column="address1" property="address1"/>
        <result column="address2" property="address2"/>
        <result column="authority" property="authority"/>
        <result column="status" property="status"/>
        <result column="point" property="point"/>
        <result column="memberImg" property="memberImg"/>
        <result column="createDate" property="createDate"/>
        <result column="updateDate" property="updateDate"/>
    </resultMap>

    <resultMap id="replyMap" type="com.metanet.metamungmung.vo.meeting.GetOnMeetingReplyVO">
        <result column="onMeetingReplyIdx" property="onMeetingReplyIdx"/>
        <result column="onMeetingBoardIdx" property="onMeetingBoardIdx"/>
        <result column="onMeetingMemIdx" property="onMeetingMemIdx"/>
        <result column="onMeetingIdx" property="onMeetingIdx"/>
        <result column="memberIDX" property="memberIdx"/>
        <result column="replyContents" property="replyContents"/>
        <result column="replyCreateDate" property="replyCreateDate"/>
        <result column="replyUpdateDate" property="replyUpdateDate"/>
        <result column="replyWriter" property="replyWriter"/>
        <result column="replyWriterImg" property="replyWriterImg"/>
        <association property="replyMember" resultMap="onMemMap" javaType="com.metanet.metamungmung.vo.meeting.GetOnMeetingMemVO"/>
    </resultMap>

    <resultMap id="onMemMap" type="com.metanet.metamungmung.vo.meeting.GetOnMeetingMemVO">
        <result column="memberIdx" property="memberIdx"/>
        <result column="memberNameVO" property="memberName"/>
        <result column="memberImgVO" property="memberImg"/>
    </resultMap>

<!--===========================================-->


<!--    <select id="getBoardList"  resultMap="boardResultMap11">-->
<!--        select *-->
<!--        from onMeeting o, onMeetingBoard ob, onMeetingMem om, member m-->
<!--        where ob.onMeetingMemIdx = om.onMeetingMemIdx-->
<!--          and om.memberIdx = m.memberIdx-->
<!--          and o.onMeetingIdx = #{onMeetingIdx}-->
<!--    </select>-->

<!--    <resultMap id="boardResultMap11" type="com.metanet.metamungmung.vo.meeting.GetOnMeetingVO">-->
<!--        <result column="onMeetingIdx" property="onMeetingIdx"/>-->
<!--        <result column="onMeetName" property="onMeetName"/>-->
<!--        <result column="createDate" property="createDate"/>-->
<!--        <result column="updateDate" property="updateDate"/>-->
<!--        <result column="introduction" property="introduction"/>-->
<!--        <result column="thumbnail" property="thumbnail"/>-->
<!--        <result column="personnel" property="personnel"/>-->
<!--        <collection property="boardList" resultMap="boardMap"/>-->
<!--&lt;!&ndash;        <collection property="onMeetingMembers" resultMap="onMeetingMemMap"/>&ndash;&gt;-->
<!--    </resultMap>-->

<!--    <resultMap type="com.metanet.metamungmung.dto.meeting.OnMeetingBoardDTO" id="boardMap">-->
<!--        <result column="onMeetingBoardIdx" property="onMeetingBoardIdx"/>-->
<!--        <result column="onMeetingMemIdx" property="onMeetingMemIdx"/>-->
<!--        <result column="onMeetingIdx" property="onMeetingIdx"/>-->
<!--        <result column="memberIdx" property="memberIdx"/>-->
<!--        <result column="writer" property="writer"/>-->
<!--        <result column="contents" property="contents"/>-->
<!--        <result column="onMeetingBoardAddr" property="onMeetingBoardAddr"/>-->
<!--        <result column="createDate" property="createDate"/>-->
<!--        <result column="updateDate" property="updateDate"/>-->
<!--        <association property="onMeetingMember" resultMap="OnMemMap" javaType="com.metanet.metamungmung.vo.meeting.GetOnMeetingMemVO"/>-->
<!--    </resultMap>-->

<!--    <resultMap type="com.metanet.metamungmung.dto.member.MemberDTO" id="OnMemMap" >-->
<!--        <result column="memberIdx" property="memberIdx"/>-->
<!--        <result column="memberId" property="memberId"/>-->
<!--        <result column="password" property="password"/>-->
<!--        <result column="memberName" property="memberName"/>-->
<!--        <result column="sex" property="sex"/>-->
<!--        <result column="birth" property="birth"/>-->
<!--        <result column="email" property="email"/>-->
<!--        <result column="phone" property="phone"/>-->
<!--        <result column="address1" property="address1"/>-->
<!--        <result column="address2" property="address2"/>-->
<!--        <result column="authority" property="authority"/>-->
<!--        <result column="status" property="status"/>-->
<!--        <result column="point" property="point"/>-->
<!--        <result column="memberImg" property="memberImg"/>-->
<!--        <result column="createDate" property="createDate"/>-->
<!--        <result column="updateDate" property="updateDate"/>-->
<!--    </resultMap>-->





    <!--해당 모임 멤버 리스트 출력-->
    <select id="getOnMeetingMembers" resultMap="memberListMap11">
        select *
        from onMeeting o, onMeetingMem om, member m
        where om.memberIdx = m.memberIdx
        and o.onMeetingIdx = #{onMeetingIdx}
    </select>

    <resultMap id="memberListMap11" type="com.metanet.metamungmung.vo.meeting.GetOnMeeting2VO">
        <result column="memberIdx" property="memberIdx"/>
<!--        <result column="memberName" property="memberName"/>-->
<!--        <result column="memberImg" property="memberImg"/>-->
        <collection property="memberList" resultMap="memberMap11"/>
    </resultMap>

    <resultMap type="com.metanet.metamungmung.dto.member.MemberDTO" id="memberMap11">
        <result column="memberIdx" property="memberIdx"/>
        <result column="memberId" property="memberId"/>
        <result column="password" property="password"/>
        <result column="memberName" property="memberName"/>
        <result column="sex" property="sex"/>
        <result column="birth" property="birth"/>
        <result column="email" property="email"/>
        <result column="phone" property="phone"/>
        <result column="address1" property="address1"/>
        <result column="address2" property="address2"/>
        <result column="authority" property="authority"/>
        <result column="status" property="status"/>
        <result column="point" property="point"/>
        <result column="memberImg" property="memberImg"/>
        <result column="createDate" property="createDate"/>
        <result column="updateDate" property="updateDate"/>
    </resultMap>

    <!--게시글 작성 // onMeetingIdx, board 객체 보내줌-->
    <insert id="registerBoard">
        insert into onMeetingBoard
        values (onMeetingBoard_seq.nextval,
                #{onMeetingMemIdx},
                #{onMeetingIdx},
                #{memberIdx},
                #{writer},
                #{contents},
                #{onMeetingBoardAddr},
                sysdate,
                sysdate
        )

<!--        <selectKey keyProperty="onMeetingIdx" order="BEFORE" resultType="Long">-->
<!--            select onMeetingBoard_seq.nextval from dual-->
<!--        </selectKey>-->

    </insert>

    <!--게시글 수정 // onMeetingIdx, board 객체 보내줌-->
<!--    <update id="updateBoard">-->
<!--        update onMeetingBoard om-->
<!--        set om,-->

<!--    </update>-->

    <!--게시글 삭제 // // onMeetingIdx, onMeetingBoardIdx 보내줌-->
<!--    <delete id="deleteBoard">-->
<!--        delete from onMeetingBoard-->
<!--        where onMeetingBoardIdx = #{onMeetingBoardIdx}-->
<!--        and onMeetingIdx = #{onMeetingIdx}-->
<!--    </delete>-->

    <!--게시글 검색 -->


</mapper>